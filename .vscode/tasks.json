{
    "version": "2.0.0",
    "tasks": [
        // Local tasks
        {
            "label": "build",
            "command": "dotnet",
            "type": "process",
            "args": [
                "build",
                "${workspaceFolder}/service-b.csproj"
            ],
            "problemMatcher": "$msCompile"
        },
        // Mindaro tasks
        {
            // This is eventually done automatically by the extension
            // The output will appear in a "Mindaro" output window
            "label": "mindaro: daemon",
            "type": "process",
            "command": "mindaro",
            "args": [
                "daemon",
                "--import",
                "microsoft/vsdbg:<necessary version>@/vsdbg:/vsdbg"
            ],
            "problemMatcher": [],
            "isBackground": true
        },
        {
            // This runs the container as a placeholder, enabling one-off commands
            "label": "mindaro: placeholder",
            "type": "process",
            "command": "mindaro",
            "args": [
                "up",                // implies a container-owned primary process
                "--incremental",     // only rebuild the image if unsunk files change
                "--placeholder",     // wait for commands, implies "--no-probes" option
                "--sync",
                "*:!*.sln:!*.*proj", // synchronize all files except *.sln and *.*proj
                "--detach"           // the daemon will maintain local port connectivity
            ],
            "problemMatcher": []
        },
        {
            // This is the Mindaro equivalent of the "build" task
            "label": "build (mindaro)",
            "dependsOn": "mindaro: placeholder", // ensures placeholder container is running
            "type": "process",
            "command": "mindaro",
            "args": [
                "exec",            // implies a client-owned secondary process
                "--kill",
                "dotnet",          // runs equivalent of "pkill -9 dotnet" before execution
                "dotnet",
                "build",
                "service-b.csproj"
            ],
            "problemMatcher": "$msCompile"
        }
    ]
}